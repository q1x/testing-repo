zabbix_export:
  version: '7.2'
  template_groups:
  - uuid: 846977d1dfed4968bc5f8bdb363285bc
    name: Templates/Operating systems
  templates:
  - uuid: 2506b0ca01884903b547b1e19b76ce6d
    template: Linux by Prom
    name: Linux by Prom
    description: |
      This template collects Linux metrics from node_exporter 0.18 and above. Support for older node_exporter versions is provided as 'best effort'.

      Setup:

      1. Set up the node_exporter according to the official documentation:
      https://prometheus.io/docs/guides/node-exporter/

      Use node_exporter v0.18.0 or above.

      2. Set the hostname or IP address of the node_exporter host in the '{$NODE_EXPORTER_HOST}' macro. You can also change the Prometheus endpoint port in the '{$NODE_EXPORTER_PORT}' macro if necessary.

      Known Issues:

        - Node Exporter 0.16.0 renamed many metrics. CPU utilization for "guest" and "guest_nice" metrics are not supported in this template with Node Exporter < 0.16. Disk IO metrics are not supported. Other metrics provided as best effort. See https://github.com/prometheus/node_exporter/releases/tag/v0.16.0 for details.
          - version: below 0.16.0
        - metric node_network_info with label 'device' cannot be found, so network discovery is not possible.
          - version: below 0.18

      Notes on filesystem (FS) discovery:
        - The ext4/3/2 FS reserves space for privileged usage, typically set at 5% by default.
        - BTRFS allocates a default of 10% of the volume for its own needs.
        - To mitigate potential disasters, FS usage triggers are based on the maximum available space.
          - Utilization formula: 'pused = 100 - 100 * (available / total - free + available)'
        - The FS utilization chart, derived from graph prototypes, reflects FS reserved space as the difference between used and available space from the total volume.

      You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/387225-discussion-thread-for-official-zabbix-template-for-linux

      Generated by official Zabbix template tool "Templator"
    vendor:
      name: Zabbix
      version: 7.2-1
    groups:
    - name: Templates/Operating systems
    tags:
    - tag: class
      value: os
    - tag: target
      value: linux
    macros:
    - macro: '{$CPU.UTIL.CRIT}'
      value: '90'
      description: Critical threshold of CPU utilization expressed in %.
    - macro: '{$IF.ERRORS.WARN}'
      value: '2'
      description: Warning threshold of error packet rate. Can be used with interface
        name as context.
    - macro: '{$IF.UTIL.MAX}'
      value: '90'
      description: Used as a threshold in the interface utilization trigger.
    - macro: '{$IFCONTROL}'
      value: '1'
      description: Link status trigger will be fired only for interfaces where the
        context macro equals "1".
    - macro: '{$KERNEL.MAXFILES.MIN}'
      value: '256'
    - macro: '{$LOAD_AVG_PER_CPU.MAX.WARN}'
      value: '1.5'
      description: Load per CPU considered sustainable. Tune if needed.
    - macro: '{$MEMORY.AVAILABLE.MIN}'
      value: 20M
      description: Used as a threshold in the memory available trigger.
    - macro: '{$MEMORY.UTIL.MAX}'
      value: '90'
      description: Used as a threshold in the memory utilization trigger.
    - macro: '{$NET.IF.IFALIAS.MATCHES}'
      value: ^.*$
      description: Used in network interface discovery rule filters.
    - macro: '{$NET.IF.IFALIAS.NOT_MATCHES}'
      value: CHANGE_IF_NEEDED
      description: Used in network interface discovery rule filters.
    - macro: '{$NET.IF.IFNAME.MATCHES}'
      value: ^.*$
      description: Used for network interface discovery. Can be overridden on the
        host or linked template level.
    - macro: '{$NET.IF.IFNAME.NOT_MATCHES}'
      value: (^Software Loopback 
        Interface|^NULL[0-9.]*$|^[Ll]o[0-9.]*$|^[Ss]ystem$|^Nu[0-9.]*$|^veth[0-9A-z]+$|docker[0-9]+|br-[a-z0-9]{12})
      description: Filters out `loopbacks`, `nulls`, docker `veth` links and `docker0`
        bridge by default.
    - macro: '{$NET.IF.IFOPERSTATUS.MATCHES}'
      value: ^.*$
      description: Used in network interface discovery rule filters.
    - macro: '{$NET.IF.IFOPERSTATUS.NOT_MATCHES}'
      value: ^notpresent$
      description: Ignore `notpresent(1)`.
    - macro: '{$NODE_EXPORTER_HOST}'
      value: <SET NODE EXPORTER HOST>
      description: The hostname or IP address of the node_exporter host.
    - macro: '{$NODE_EXPORTER_PORT}'
      value: '9100'
      description: TCP Port node_exporter is listening on.
    - macro: '{$SWAP.PFREE.MIN.WARN}'
      value: '50'
      description: Warning threshold of the minimum free swap.
    - macro: '{$SYSTEM.FUZZYTIME.MAX}'
      value: 60s
      description: The upper threshold for difference of system time.
    - macro: '{$SYSTEM.FUZZYTIME.MIN}'
      value: 10s
      description: The lower threshold for difference of system time. Used in recovery
        expression to avoid trigger flapping.
    - macro: '{$VFS.DEV.DEVNAME.MATCHES}'
      value: .+
      description: Used in block device discovery. Can be overridden on the host or
        linked template level.
    - macro: '{$VFS.DEV.DEVNAME.NOT_MATCHES}'
      value: 
        ^(loop[0-9]*|sd[a-z][0-9]+|nbd[0-9]+|sr[0-9]+|fd[0-9]+|dm-[0-9]+|ram[0-9]+|ploop[a-z0-9]+|md[0-9]*|hcp[0-9]*|zram[0-9]*)
      description: Used in block device discovery. Can be overridden on the host or
        linked template level.
    - macro: '{$VFS.DEV.READ.AWAIT.WARN}'
      value: '20'
      description: Disk read average response time (in ms) before the trigger fires.
    - macro: '{$VFS.DEV.WRITE.AWAIT.WARN}'
      value: '20'
      description: Disk write average response time (in ms) before the trigger fires.
    - macro: '{$VFS.FS.FSDEVICE.MATCHES}'
      value: ^.+$
      description: Used in filesystem discovery. Can be overridden on the host or
        linked template level.
    - macro: '{$VFS.FS.FSDEVICE.NOT_MATCHES}'
      value: ^\s$
      description: Used in filesystem discovery. Can be overridden on the host or
        linked template level.
    - macro: '{$VFS.FS.FSNAME.MATCHES}'
      value: .+
      description: Used in filesystem discovery. Can be overridden on the host or
        linked template level.
    - macro: '{$VFS.FS.FSNAME.NOT_MATCHES}'
      value: ^(/dev|/sys|/run|/proc|.+/shm$)
      description: Used in filesystem discovery. Can be overridden on the host or
        linked template level.
    - macro: '{$VFS.FS.FSTYPE.MATCHES}'
      value: 
        ^(btrfs|ext2|ext3|ext4|reiser|xfs|ffs|ufs|jfs|jfs2|vxfs|hfs|apfs|refs|ntfs|fat32|zfs)$
      description: Used in filesystem discovery. Can be overridden on the host or
        linked template level.
    - macro: '{$VFS.FS.FSTYPE.NOT_MATCHES}'
      value: ^\s$
      description: Used in filesystem discovery. Can be overridden on the host or
        linked template level.
    - macro: '{$VFS.FS.INODE.PFREE.MIN.CRIT}'
      value: '10'
      description: The critical threshold of the filesystem metadata utilization.
    - macro: '{$VFS.FS.INODE.PFREE.MIN.WARN}'
      value: '20'
      description: The warning threshold of the filesystem metadata utilization.
    - macro: '{$VFS.FS.PUSED.MAX.CRIT}'
      value: '90'
      description: The critical threshold of the filesystem utilization.
    - macro: '{$VFS.FS.PUSED.MAX.WARN}'
      value: '80'
      description: The warning threshold of the filesystem utilization.
