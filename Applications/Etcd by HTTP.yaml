zabbix_export:
  version: '7.2'
  template_groups:
  - uuid: a571c0d144b14fd4a87a9d9b2aa9fcd6
    name: Templates/Applications
  templates:
  - uuid: b25b8b517a4743c48037bfa10af3dc3c
    template: Etcd by HTTP
    name: Etcd by HTTP
    description: |
      This template is designed to monitor 'etcd' by Zabbix that works without any external scripts.
      Most of the metrics are collected in one go, thanks to Zabbix bulk data collection.

      The template 'Etcd by HTTP' â€” collects metrics by help of the HTTP agent from '/metrics' endpoint.

      Refer to the vendor documentation:
      https://etcd.io/docs/v3.5/op-guide/monitoring/#metrics-endpoint

      For the users of 'etcd version <= 3.4':

      In 'etcd v3.5' some metrics have been deprecated. See more details on 'Upgrade etcd from 3.4 to 3.5':
      https://etcd.io/docs/v3.4/upgrades/upgrade_3_5/
      Please upgrade your 'etcd' instance, or use older 'Etcd by HTTP' template version.

      Setup:

      1. Make sure that 'etcd' allows the collection of metrics. You can test it by running:
      curl -L http://localhost:2379/metrics

      2. Check if 'etcd' is accessible from Zabbix proxy or Zabbix server depending on where you are planning to do the monitoring. To verify it, run:
      curl -L  http://<etcd_node_address>:2379/metrics

      3. Add the template to the 'etcd' node. Set the hostname or IP address of the 'etcd' host in the '{$ETCD.HOST}' macro. By default, the template uses a client's port.
      You can configure metrics endpoint location by adding '--listen-metrics-urls' flag.

      For more details, see the etcd documentation:
      https://etcd.io/docs/v3.5/op-guide/configuration/#profiling-and-monitoring

      Additional points to consider:

      - If you have specified a non-standard port for 'etcd', don't forget to change macros: '{$ETCD.SCHEME}' and '{$ETCD.PORT}'.
      - You can set '{$ETCD.USERNAME}' and '{$ETCD.PASSWORD}' macros in the template to use on a host level if necessary.
      - To test availability, run : 'zabbix_get -s etcd-host -k etcd.health'.

      Generated by official Zabbix template tool "Templator"
    vendor:
      name: Zabbix
      version: 7.2-1
    groups:
    - name: Templates/Applications
    tags:
    - tag: class
      value: application
    - tag: target
      value: etcd
    macros:
    - macro: '{$ETCD.GRPC.ERRORS.MAX.WARN}'
      value: '1'
      description: The maximum number of gRPC request failures.
    - macro: '{$ETCD.GRPC_CODE.MATCHES}'
      value: .*
      description: The filter of discoverable gRPC codes. See more details on https://github.com/grpc/grpc/blob/master/doc/statuscodes.md.
    - macro: '{$ETCD.GRPC_CODE.NOT_MATCHES}'
      value: CHANGE_IF_NEEDED
      description: The filter to exclude discovered gRPC codes. See more details on
        https://github.com/grpc/grpc/blob/master/doc/statuscodes.md.
    - macro: '{$ETCD.GRPC_CODE.TRIGGER.MATCHES}'
      value: Aborted|Unavailable
      description: The filter of discoverable gRPC codes, which will create triggers.
    - macro: '{$ETCD.HOST}'
      value: <SET ETCD HOST>
      description: The hostname or IP address of the `etcd` API endpoint.
    - macro: '{$ETCD.HTTP.FAIL.MAX.WARN}'
      value: '2'
      description: The maximum number of HTTP request failures.
    - macro: '{$ETCD.LEADER.CHANGES.MAX.WARN}'
      value: '5'
      description: The maximum number of leader changes.
    - macro: '{$ETCD.OPEN.FDS.MAX.WARN}'
      value: '90'
      description: The maximum percentage of used file descriptors.
    - macro: '{$ETCD.PASSWORD}'
    - macro: '{$ETCD.PORT}'
      value: '2379'
      description: The port of the `etcd` API endpoint.
    - macro: '{$ETCD.PROPOSAL.FAIL.MAX.WARN}'
      value: '2'
      description: The maximum number of proposal failures.
    - macro: '{$ETCD.PROPOSAL.PENDING.MAX.WARN}'
      value: '5'
      description: The maximum number of proposals in queue.
    - macro: '{$ETCD.SCHEME}'
      value: http
      description: The request scheme which may be `http` or `https`.
    - macro: '{$ETCD.USER}'
