zabbix_export:
  version: '7.2'
  template_groups:
  - uuid: 748ad4d098d447d492bb935c907f652f
    name: Templates/Databases
  templates:
  - uuid: e0a7c3e725c445228b03116dc6114fe9
    template: PostgreSQL by ODBC
    name: PostgreSQL by ODBC
    description: |
      This template is designed for the effortless deployment of PostgreSQL monitoring by Zabbix via ODBC and doesn't require any external scripts.

      Setup:

      1. Create the PostgreSQL user for monitoring (`<password>` at your discretion) and inherit permissions from the default role `pg_monitor`:
      CREATE USER zbx_monitor WITH PASSWORD '<PASSWORD>' INHERIT;
      GRANT pg_monitor TO zbx_monitor;

      2. Edit the `pg_hba.conf` configuration file to allow TCP connections for the user `zbx_monitor`. You can check the PostgreSQL documentation for examples (https://www.postgresql.org/docs/current/auth-pg-hba-conf.html).

      3. Install the PostgreSQL ODBC driver.

      4. Set up the connection string with the `{$PG.CONNSTRING.ODBC}` macro. The minimum required parameters are:
      - `Driver=` - set the name of the driver which will be used for monitoring (from the `odbcinst.ini` file) or specify the path to the driver file (for example `/usr/lib64/psqlodbcw.so`);
      - `Servername=` - set the host name or IP address of the PostgreSQL instance;
      - `Port=` - adjust the port number if needed.

      If you want to use SSL/TLS encryption to protect communications with the remote PostgreSQL instance, you can also specify encryption parameters here.

      It is assumed that you set up the PostgreSQL instance to work in the desired encryption mode. Check the PostgreSQL documentation (https://www.postgresql.org/docs/current/ssl-tcp.html) for details.

      For example, to enable required encryption in transport mode without identity checks, the connection string could look like this (replace `<instanceip>` with the address of the PostgreSQL instance):
      Servername=<instanceip>;Port=5432;Driver=/usr/lib64/psqlodbcw.so;SSLmode=require

      5. Set the password that you specified in step 1 in the macro `{$PG.PASSWORD}`.

      You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/384190-%C2%A0discussion-thread-for-official-zabbix-template-db-postgresql

      Generated by official Zabbix template tool "Templator"
    vendor:
      name: Zabbix
      version: 7.2-1
    groups:
    - name: Templates/Databases
    tags:
    - tag: class
      value: database
    - tag: target
      value: postgresql
    macros:
    - macro: '{$PG.CONFLICTS.MAX.WARN}'
      value: '0'
      description: Maximum number of recovery conflicts for trigger expression.
    - macro: '{$PG.CONNSTRING.ODBC}'
      value: Servername=localhost;Port=5432;Driver=/usr/lib64/psqlodbcw.so
      description: Connection string for the PostgreSQL instance.
    - macro: '{$PG.CONN_TOTAL_PCT.MAX.WARN}'
      value: '90'
      description: Maximum percentage of current connections for trigger expression.
    - macro: '{$PG.DATABASE}'
      value: postgres
      description: Default PostgreSQL database for the connection.
    - macro: '{$PG.DEADLOCKS.MAX.WARN}'
      value: '0'
      description: Maximum number of detected deadlocks for trigger expression.
    - macro: '{$PG.LLD.FILTER.APPLICATION}'
      value: .+
      description: Filter of discoverable applications.
    - macro: '{$PG.LLD.FILTER.DBNAME}'
      value: .+
      description: Filter of discoverable databases.
    - macro: '{$PG.PASSWORD}'
      value: <Put the password here>
      description: PostgreSQL user password.
    - macro: '{$PG.QUERY_ETIME.MAX.WARN}'
      value: '30'
      description: Execution time limit for count of slow queries.
    - macro: '{$PG.SLOW_QUERIES.MAX.WARN}'
      value: '5'
      description: Slow queries count threshold for a trigger.
    - macro: '{$PG.USER}'
      value: zbx_monitor
      description: PostgreSQL username.
