zabbix_export:
  version: '7.2'
  template_groups:
  - uuid: 748ad4d098d447d492bb935c907f652f
    name: Templates/Databases
  templates:
  - uuid: 36116d8675da47b8a678193969d5a787
    template: CockroachDB by HTTP
    name: CockroachDB by HTTP
    description: |
      The template to monitor CockroachDB nodes by Zabbix that works without any external scripts.
      Most of the metrics are collected in one go, thanks to Zabbix bulk data collection.

      The template collects metrics by HTTP agent from Prometheus endpoint and health endpoints.

      Internal node metrics are collected from Prometheus /_status/vars endpoint.
      Node health metrics are collected from /health and /health?ready=1 endpoints.
      The template doesn't require usage of session token.

      Note, that some metrics may not be collected depending on your CockroachDB version and configuration.

      Setup:

      Set the hostname or IP address of the CockroachDB node host in the '{$COCKROACHDB.API.HOST}' macro. You can also change the port in the '{$COCKROACHDB.API.PORT}' macro and the scheme in the '{$COCKROACHDB.API.SCHEME}' macro if necessary.

      You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback

      Generated by official Zabbix template tool "Templator"
    vendor:
      name: Zabbix
      version: 7.2-1
    groups:
    - name: Templates/Databases
    tags:
    - tag: class
      value: database
    - tag: target
      value: cockroachdb
    macros:
    - macro: '{$COCKROACHDB.API.HOST}'
      value: <SET COCKROACHDB HOST>
      description: The hostname or IP address of the CockroachDB host.
    - macro: '{$COCKROACHDB.API.PORT}'
      value: '8080'
      description: The port of CockroachDB API and Prometheus endpoint.
    - macro: '{$COCKROACHDB.API.SCHEME}'
      value: http
      description: Request scheme which may be http or https.
    - macro: '{$COCKROACHDB.CERT.CA.EXPIRY.WARN}'
      value: '90'
      description: Number of days until the CA certificate expires.
    - macro: '{$COCKROACHDB.CERT.NODE.EXPIRY.WARN}'
      value: '30'
      description: Number of days until the node certificate expires.
    - macro: '{$COCKROACHDB.CLOCK.OFFSET.MAX.WARN}'
      value: '300'
      description: Maximum clock offset of the node against the rest of the cluster
        in milliseconds for trigger expression.
    - macro: '{$COCKROACHDB.OPEN.FDS.MAX.WARN}'
      value: '80'
      description: Maximum percentage of used file descriptors.
    - macro: '{$COCKROACHDB.STATEMENTS.ERRORS.MAX.WARN}'
      value: '2'
      description: Maximum number of SQL statements errors for trigger expression.
    - macro: '{$COCKROACHDB.STORE.USED.MIN.CRIT}'
      value: '10'
      description: The critical threshold of the available disk space in percent.
    - macro: '{$COCKROACHDB.STORE.USED.MIN.WARN}'
      value: '20'
      description: The warning threshold of the available disk space in percent.
