zabbix_export:
  version: '7.2'
  template_groups:
  - uuid: 748ad4d098d447d492bb935c907f652f
    name: Templates/Databases
  templates:
  - uuid: 75fc96367e8d4588ba8314145fc12d35
    template: MSSQL by Zabbix agent 2
    name: MSSQL by Zabbix agent 2
    description: |
      This template is designed for the effortless deployment of MSSQL monitoring by Zabbix via Zabbix agent 2 and uses a loadable plugin to run SQL queries.

      Setup:

      1. Deploy Zabbix agent 2 with the MSSQL plugin. You can use this template starting with Zabbix versions 6.0.27 / 6.4.12.

        For more information, see MSSQL plugin documentation: https://git.zabbix.com/projects/AP/repos/mssql/browse
        
        Loadable plugin requires installation of one of the following:

        - Separate package
        
        - Binary file
        
        - Compilation from sources: https://www.zabbix.com/documentation/7.2/manual/extensions/plugins/build

      2. Create an MSSQL user for monitoring.

        View Server State and View Any Definition permissions should be granted to the user.
        Grant this user read permissions to the sysjobschedules, sysjobhistory, and sysjobs tables.

        For more information, see MSSQL documentation:
        
        - Create a database user: https://docs.microsoft.com/en-us/sql/relational-databases/security/authentication-access/create-a-database-user?view=sql-server-ver16
        
        - GRANT Server Permissions: https://docs.microsoft.com/en-us/sql/t-sql/statements/grant-server-permissions-transact-sql?view=sql-server-ver16
        
        - Configure a User to Create and Manage SQL Server Agent Jobs: https://docs.microsoft.com/en-us/sql/ssms/agent/configure-a-user-to-create-and-manage-sql-server-agent-jobs?view=sql-server-ver16

      3. Set the user name and password in the host macros ({$MSSQL.USER} and {$MSSQL.PASSWORD}).

      4. Set the connection string for the MSSQL instance in the {$MSSQL.URI} macro as a URI, such as <protocol://host:port>, or specify the named session - <sessionname>.

      The "Service's TCP port state" item uses the {$MSSQL.HOST} and {$MSSQL.PORT} macros to check the availability of the MSSQL instance, change these if necessary. Keep in mind that if dynamic ports are used on the MSSQL server side, this check will not work correctly.

      Note: You can use the context macros {$MSSQL.BACKUP_FULL.USED}, {$MSSQL.BACKUP_LOG.USED}, and {$MSSQL.BACKUP_DIFF.USED} to disable backup age triggers for a certain database. If set to a value other than "1", the trigger expression for the backup age will not fire.

      Note: Since version 7.2.0, you can also connect to the MSSQL instance using its name. To do this, set the connection string in the {$MSSQL.URI} macro as <protocol://host/instance_name>.

      Generated by official Zabbix template tool "Templator"
    vendor:
      name: Zabbix
      version: 7.2-3
    groups:
    - name: Templates/Databases
    tags:
    - tag: class
      value: database
    - tag: target
      value: mssql
    macros:
    - macro: '{$MSSQL.AVERAGE_WAIT_TIME.MAX}'
      value: '500'
      description: The maximum average wait time, in milliseconds - for the trigger
        expression.
    - macro: '{$MSSQL.BACKUP_DIFF.CRIT}'
      value: 6d
      description: The maximum of days without a differential backup - for the High
        trigger expression.
    - macro: '{$MSSQL.BACKUP_DIFF.USED}'
      value: '1'
      description: The flag for checking the age of a differential backup. If set
        to a value other than "1", the trigger expression for the differential backup
        age will not fire. Can be used with context for database name.
    - macro: '{$MSSQL.BACKUP_DIFF.WARN}'
      value: 3d
      description: The maximum of days without a differential backup - for the Warning
        trigger expression.
    - macro: '{$MSSQL.BACKUP_DURATION.WARN}'
      value: 1h
      description: The maximum job duration - for the Warning trigger expression.
    - macro: '{$MSSQL.BACKUP_FULL.CRIT}'
      value: 10d
      description: The maximum of days without a full backup - for the High trigger
        expression.
    - macro: '{$MSSQL.BACKUP_FULL.USED}'
      value: '1'
      description: The flag for checking the age of a full backup. If set to a value
        other than "1", the trigger expression for the full backup age will not fire.
        Can be used with context for database name.
    - macro: '{$MSSQL.BACKUP_FULL.WARN}'
      value: 9d
      description: The maximum of days without a full backup - for the Warning trigger
        expression.
    - macro: '{$MSSQL.BACKUP_LOG.CRIT}'
      value: 8h
      description: The maximum of days without a log backup - for the High trigger
        expression.
    - macro: '{$MSSQL.BACKUP_LOG.USED}'
      value: '1'
      description: The flag for checking the age of a log backup. If set to a value
        other than "1", the trigger expression for the log backup age will not fire.
        Can be used with context for database name.
    - macro: '{$MSSQL.BACKUP_LOG.WARN}'
      value: 4h
      description: The maximum of days without a log backup - for the Warning trigger
        expression.
    - macro: '{$MSSQL.BUFFER_CACHE_RATIO.MIN.CRIT}'
      value: '30'
      description: The minimum buffer cache hit ratio, in percent - for the High trigger
        expression.
    - macro: '{$MSSQL.BUFFER_CACHE_RATIO.MIN.WARN}'
      value: '50'
      description: The minimum buffer cache hit ratio, in percent - for the Warning
        trigger expression.
    - macro: '{$MSSQL.DBNAME.MATCHES}'
      value: .*
      description: This macro is used in database discovery. It can be overridden
        on the host or linked template level.
    - macro: '{$MSSQL.DBNAME.NOT_MATCHES}'
      value: master|tempdb|model|msdb
      description: This macro is used in database discovery. It can be overridden
        on the host or linked template level.
    - macro: '{$MSSQL.DEADLOCKS.MAX}'
      value: '1'
      description: The maximum deadlocks per second - for the trigger expression.
    - macro: '{$MSSQL.FREE_LIST_STALLS.MAX}'
      value: '2'
      description: The maximum free list stalls per second - for the trigger expression.
    - macro: '{$MSSQL.HOST}'
      value: localhost
      description: The hostname or IP address of the MSSQL instance.
    - macro: '{$MSSQL.JOB.MATCHES}'
      value: .*
      description: This macro is used in job discovery. It can be overridden on the
        host or linked template level.
    - macro: '{$MSSQL.JOB.NOT_MATCHES}'
      value: CHANGE_IF_NEEDED
      description: This macro is used in job discovery. It can be overridden on the
        host or linked template level.
    - macro: '{$MSSQL.LAZY_WRITES.MAX}'
      value: '20'
      description: The maximum lazy writes per second - for the trigger expression.
    - macro: '{$MSSQL.LOCK_REQUESTS.MAX}'
      value: '1000'
      description: The maximum lock requests per second - for the trigger expression.
    - macro: '{$MSSQL.LOCK_TIMEOUTS.MAX}'
      value: '1'
      description: The maximum lock timeouts per second - for the trigger expression.
    - macro: '{$MSSQL.LOG_FLUSH_WAITS.MAX}'
      value: '1'
      description: The maximum log flush waits per second - for the trigger expression.
    - macro: '{$MSSQL.LOG_FLUSH_WAIT_TIME.MAX}'
      value: '1'
      description: The maximum log flush wait time, in milliseconds - for the trigger
        expression.
    - macro: '{$MSSQL.PAGE_LIFE_EXPECTANCY.MIN}'
      value: '300'
      description: The minimum page life expectancy - for the trigger expression.
    - macro: '{$MSSQL.PAGE_READS.MAX}'
      value: '90'
      description: The maximum page reads per second - for the trigger expression.
    - macro: '{$MSSQL.PAGE_WRITES.MAX}'
      value: '90'
      description: The maximum page writes per second - for the trigger expression.
    - macro: '{$MSSQL.PASSWORD}'
      value: <Put your password here>
      description: MSSQL user password.
    - macro: '{$MSSQL.PERCENT_COMPILATIONS.MAX}'
      value: '10'
      description: The maximum percentage of Transact-SQL compilations - for the trigger
        expression.
    - macro: '{$MSSQL.PERCENT_LOG_USED.MAX}'
      value: '80'
      description: The maximum percentage of log used - for the trigger expression.
    - macro: '{$MSSQL.PERCENT_READAHEAD.MAX}'
      value: '20'
      description: The maximum percentage of pages read per second in anticipation
        of use - for the trigger expression.
    - macro: '{$MSSQL.PERCENT_RECOMPILATIONS.MAX}'
      value: '10'
      description: The maximum percentage of Transact-SQL recompilations - for the
        trigger expression.
    - macro: '{$MSSQL.PORT}'
      value: '1433'
      description: MSSQL TCP port.
    - macro: '{$MSSQL.URI}'
      value: <Put your URI here>
      description: Connection string.
    - macro: '{$MSSQL.USER}'
      value: <Put your username here>
      description: MSSQL username.
    - macro: '{$MSSQL.WORKTABLES_FROM_CACHE_RATIO.MIN.CRIT}'
      value: '90'
      description: The minimum percentage of work tables from the cache ratio - for
        the High trigger expression.
    - macro: '{$MSSQL.WORK_FILES.MAX}'
      value: '20'
      description: The maximum number of work files created per second - for the trigger
        expression.
    - macro: '{$MSSQL.WORK_TABLES.MAX}'
      value: '20'
      description: The maximum number of work tables created per second - for the
        trigger expression.
