zabbix_export:
  version: '7.2'
  template_groups:
  - uuid: 1d12408342854fd5a4436dd6d5d1bd4a
    name: Templates/Telephony
  templates:
  - uuid: 30cc187a4e994c39b07f53d86b5cc6bc
    template: Asterisk by HTTP
    name: Asterisk by HTTP
    description: |
      The template gets Asterisk metrics from AMI by HTTP agent.
      You should enable the mini-HTTP Server, add the option webenabled=yes in the general section of the manager.conf file and create Asterisk Manager user with system and command write permissions within your Asterisk instance.
      Disable the PJSIP driver if you do not use PJSIP or do not have PJSIP endpoints.
      Please, define AMI address in the {$AMI.URL} macro. Also, set the hostname or IP address of the AMI host in the {$AMI.HOST} macro for Zabbix to check Asterisk service status.
      Then you can define {$AMI.USERNAME} and {$AMI.SECRET} macros in the template for using on the host level.
      If there are errors, increase the logging to debug level and see the Zabbix server log.

      You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/410060-discussion-thread-for-official-zabbix-template-asterisk

      Generated by official Zabbix template tool "Templator"
    vendor:
      name: Zabbix
      version: 7.2-1
    groups:
    - name: Templates/Telephony
    tags:
    - tag: class
      value: voip
    - tag: target
      value: asterisk
    macros:
    - macro: '{$AMI.HOST}'
      value: <SET AMI HOST>
      description: The hostname or IP address of the Asterisk Manager API host.
    - macro: '{$AMI.PORT}'
      value: '5038'
      description: AMI port number for checking service availability.
    - macro: '{$AMI.QUEUE_CALLERS.MAX.WARN}'
      value: '10'
      description: The maximum number of callers in a queue for trigger expression.
    - macro: '{$AMI.RESPONSE_TIME.MAX.WARN}'
      value: 10s
      description: The Asterisk Manager API page maximum response time in seconds
        for trigger expression.
    - macro: '{$AMI.SECRET}'
      value: zabbix
      description: The Asterisk Manager secret.
    - macro: '{$AMI.TRUNK_ACTIVE_CHANNELS.MAX.WARN}'
      value: '28'
      description: The maximum number of busy channels of a trunk for trigger expression.
    - macro: '{$AMI.TRUNK_ACTIVE_CHANNELS_TOTAL.MAX.WARN:"IAX"}'
      value: '28'
      description: The total maximum number of busy channels of IAX trunks for trigger
        expression.
    - macro: '{$AMI.TRUNK_ACTIVE_CHANNELS_TOTAL.MAX.WARN:"PJSIP"}'
      value: '28'
      description: The total maximum number of busy channels of PJSIP trunks for trigger
        expression.
    - macro: '{$AMI.TRUNK_ACTIVE_CHANNELS_TOTAL.MAX.WARN:"SIP"}'
      value: '28'
      description: The total maximum number of busy channels of SIP trunks for trigger
        expression.
    - macro: '{$AMI.TRUNK_REGEXP}'
      value: trunk
      description: The regexp for the identification of trunk peers.
    - macro: '{$AMI.URL}'
      value: http://asterisk:8088/asterisk/rawman
      description: The Asterisk Manager API URL in the format `<scheme>://<host>:<port>/<prefix>/rawman`.
    - macro: '{$AMI.USERNAME}'
      value: zabbix
      description: The Asterisk Manager name.
